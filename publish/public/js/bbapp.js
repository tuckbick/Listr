$(function(){window.Item=Backbone.Model.extend({url:function(){return"items/"},idAttribute:"_id",defaults:{content:"<none>",done:!1},initialize:function(){},clear:function(){this.destroy()}});window.ItemView=Backbone.View.extend({template:_.template($("#item-template").html()),tagName:"li",$delete:$('<a href="#" data-role="button" class="delete"><span class="inner" aria-hidden="true"><span class="text">Delete</span><span class="icon"></span></span></a>'),events:{vmouseover:"selectItem",swiperight:"showDeleteOption",
"click .delete":"deleteItem"},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},initialize:function(a){_.bindAll(this,"remove","render");this.model.bind("destroy",this.remove);this.model.bind("change",this.render);this.$el=$(this.el).attr("id",a.model.get("_id"))},toggleDone:function(){},selectItem:function(){var a=this.$el.siblings(".current").removeClass("current");a.find(".delete").remove();clearTimeout(a.data("t"));this.$el.addClass("current");var b=this;b.$el.data("t",
setTimeout(function(){b.$el.removeClass("current").find(".delete").remove()},1E4))},showDeleteOption:function(){this.$el.append(this.$delete)},remove:function(){this.$el.slideUp(100,this.$el.remove)},deleteItem:function(){this.model.clear()}});window.ItemList=Backbone.Collection.extend({model:Item,url:function(){return"items/"},store:new Store});window.Items=new ItemList;window.AppView=Backbone.View.extend({el:$("body"),events:{"submit form#new_item":"newItem"},initialize:function(){var a=this;_.bindAll(this,
"addOne","addAll");this.dialog=this.$el.find("#new");this.toolbar=this.$el.find("#toolbar");this.input=this.dialog.find("form#new_item input[name=content]");this.item_list=this.$el.find("#item-list");this.toolbar.fixedtoolbar({tapToggle:!1});this.dialog.on("pageinit",function(){a.input.focus()});Items.bind("add",this.addOne);Items.bind("reset",this.addAll);Items.fetch()},scrollToBottom:function(){var a=this.el;setTimeout(function(){scrollTo(0,a.scrollHeight)},1E3)},newAttributes:function(){return{content:this.input.val(),
done:!1}},newItem:function(a){a.preventDefault();console.log("new");a=this.newAttributes();a=Items.create(a);this.item_list.listview("refresh");this.scrollToBottom();a.view.selectItem();console.log(this.dialog);this.dialog.dialog("close");this.input.val("");return!1},addOne:function(a){a=new ItemView({model:a});a.model.view=a;this.item_list.append(a.render().el)},addAll:function(){Items.each(this.addOne);this.item_list.listview("refresh")}});window.App=new AppView});
$(document).bind("mobileinit",function(){$.event.special.swipe.horizontalDistanceThreshold=100});
